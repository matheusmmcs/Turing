<!doctype html>
<head>
	<meta charset="utf-8" />
	<title>Turing machine in JavaScript</title>
	<link rel="stylesheet" href="css/style.css" />
	<link href='css/font-awesome.css' rel='stylesheet' />

	<script src="js/vendor/jquery.js"></script>
	<script src="js/vendor/raphael.js"></script>
	<script src="js/vendor/joint.js"></script>

	<script src="js/app/turing.js"></script>
	<script>
		$(function () {

			// Graph
			/*
	        var r = Raphael('canvas', 640, 400);
			var top = 200;
			
	        var s1 = r.circle(40, top + 0, 20);
	        s1.node.setAttribute('class', 'state s1');
	        var t1 = r.text(40, top + 0, "s1").attr({ "font-size": 15});
	        t1.node.setAttribute('class', 'text s1');
	        
	        var s2 = r.circle(200, top + 0, 20);
	        s2.node.setAttribute('class', 'state s2');
	        var t2 = r.text(200, top + 0, "s2").attr({ "font-size": 15});
	        t2.node.setAttribute('class', 'text s2');

	        var s3 = r.circle(350, top + 0, 20);
	        s3.node.setAttribute('class', 'state s3');
	        var t3 = r.text(350, top + 0, "s3").attr({ "font-size": 15});
	        t3.node.setAttribute('class', 'text s3');

	        var s4 = r.circle(500, top + 0, 20);
	        s4.node.setAttribute('class', 'state s4');
	        var t4 = r.text(500, top + 0, "s4").attr({ "font-size": 15});
	        t4.node.setAttribute('class', 'text s4');

	        var s5 = r.circle(500, top + 160, 20);
	        s5.node.setAttribute('class', 'state s5');
	       	var t5 = r.text(500, top + 160, "s5").attr({ "font-size": 15});
	        t5.node.setAttribute('class', 'text s5');
	        

	        var s6 = r.circle(350, top + 160, 20);
	        s6.node.setAttribute('class', 'state s6');
	        var t6 = r.text(350, top + 160, "s6").attr({ "font-size": 15});
	        t6.node.setAttribute('class', 'text s6');

	        var s7 = r.circle(200, top - 100, 20);
	        s7.node.setAttribute('class', 'state s7');
	        var t7 = r.text(200, top - 100, "s7").attr({ "font-size": 15});
	        t7.node.setAttribute('class', 'text s7');

	        var s8 = r.circle(40, top - 100, 20);
	        s8.node.setAttribute('class', 'state s8');
	        var t8 = r.text(40, top - 100, "s8").attr({ "font-size": 15});
	        t8.node.setAttribute('class', 'text s8');

	        s1.joint(s2, {label: '1 / X, R', attrs: {'stroke-dasharray': 'none'}});
	        s2.joint(s2, {label: '1 / 1, R', vertices: ['230 ' + (top + 80), '160 ' + (top + 80)], attrs: {'stroke-dasharray': 'none'}});
	        s2.joint(s3, {label: '* / *, R', attrs: {'stroke-dasharray': 'none'}});
	        s3.joint(s4, {label: '1 / Y, R', attrs: {'stroke-dasharray': 'none'}});
	        s3.joint(s6, {label: '= / =, L', attrs: {'stroke-dasharray': 'none'}});
	        s4.joint(s4, {label: '1 / 1, R\n= / =, R', vertices: ['560 ' + (top - 40), '560 ' + (top + 40)], attrs: {'stroke-dasharray': 'none'}});
	        s4.joint(s5, {label: '  / 1, L', attrs: {'stroke-dasharray': 'none'}});
	        s5.joint(s5, {label: '1 / 1, L\n= / =, L', vertices: ['560 ' + (top + 120), '560 ' + (top + 200)], attrs: {'stroke-dasharray': 'none'}});
	        s5.joint(s3, {label: 'Y / Y, R', attrs: {'stroke-dasharray': 'none'}});
	        s6.joint(s6, {label: 'Y / 1, L\n* / *, L\n1 / 1, L', vertices: ['410 ' + (top + 120), '410 ' + (top + 200)], attrs: {'stroke-dasharray': 'none'}});
	        s6.joint(s1, {label: 'X / X, R', vertices: ['180 ' + (top + 160)], attrs: {'stroke-dasharray': 'none'}});
	        s1.joint(s8, {label: '* / *, R', attrs: {'stroke-dasharray': 'none'}});

	        s1.joint(s7, {label: '0 / 0, R', attrs: {'stroke-dasharray': 'none'}});
	        s3.joint(s7, {label: '0 / 0, R', attrs: {'stroke-dasharray': 'none'}});
	        s7.joint(s7, {label: '* / *, R\n1 / 1, R\n0 / 0, R\n= / =, R', vertices: ['230 ' + (top - 170), '160 ' + (top - 170)], attrs: {'stroke-dasharray': 'none'}});
	        s7.joint(s8, {label: '  / 0, R', attrs: {'stroke-dasharray': 'none'}});
			*/

	        // Steps
			var steps = {};
			steps['s1:1'] = {state: 's2', value: 'X', move: 'right'};
	        steps['s1:*'] = {state: 's8', value: '*', move: 'right'};

	        // s2: move to right until * and goto s3 
	        steps['s2:1'] = {state: 's2', value: '1', move: 'right'};
	        steps['s2:*'] = {state: 's3', value: '*', move: 'right'};

	        // s3: replace 1 with Y and goto s4
	        steps['s3:1'] = {state: 's4', value: 'Y', move: 'right'};
	        steps['s3:='] = {state: 's6', value: '=', move: 'left'};

	        // s4: write 1 into empty place and goto s5
	        steps['s4:1'] = {state: 's4', value: '1', move: 'right'};
	        steps['s4:='] = {state: 's4', value: '=', move: 'right'};
	        steps['s4:']  = {state: 's5', value: '1', move: 'left'};
	        
	        // s4: seek left until Y
	        steps['s5:1'] = {state: 's5', value: '1', move: 'left'};
	        steps['s5:='] = {state: 's5', value: '=', move: 'left'};
	        steps['s5:Y'] = {state: 's3', value: 'Y', move: 'right'};

	        // s6: cleanup Y and seek X
	        steps['s6:Y'] = {state: 's6', value: '1', move: 'left'};
	        steps['s6:*'] = {state: 's6', value: '*', move: 'left'};
	        steps['s6:1'] = {state: 's6', value: '1', move: 'left'};
	        steps['s6:X'] = {state: 's1', value: 'X', move: 'right'};
	        
	        // handle 0
	        steps['s1:0'] = {state: 's7', value: '0', move: 'right'};
	        steps['s3:0'] = {state: 's7', value: '0', move: 'right'};
	        steps['s7:*'] = {state: 's7', value: '*', move: 'right'};
	        steps['s7:1'] = {state: 's7', value: '1', move: 'right'};
	        steps['s7:0'] = {state: 's7', value: '0', move: 'right'};
	        steps['s7:='] = {state: 's7', value: '=', move: 'right'};
	        steps['s7:']  = {state: 's8', value: '0', move: 'right'};
	        
	        var turing = new Turing(steps, 's1', 's8');
			turing.tape1 = ['1', '1', '1', '*', '1', '1', '='];
			turing.reset();

			turing.stringToSteps($("#steps-area").text());

			$('#run').click(function (e) {
				e.preventDefault();
				turing.run();
			});

			$('#step').click(function (e) {
				e.preventDefault();
				turing.step();
			});

			$('#reset').click(function (e) {
				e.preventDefault();
				turing.reset();
			});

			//Save Tape
			$(".turing-tape1 input, .turing-tape2 input").keyup(function(e){
				$("#save-tape").removeClass("hidden");
			});

			$("#save-tape").click(function(e){
				e.preventDefault();
				turing.changeTape();
				$(this).addClass("hidden");
			});


			//Save Transitions
			var stepsAreaHidden = true;
			$("#steps-area").keyup(function(e){
				if(stepsAreaHidden){
					$("#save-automato").removeClass("hidden");
					stepsAreaHidden = false;
				}
			});

			$("#save-automato").click(function(e){
				e.preventDefault();
				turing.changeTape();
				$(this).addClass("hidden");
				stepsAreaHidden = true;
			});


			//Save Config
			$("#tape-size, #speed").keyup(function(e){
				$("#save-config").removeClass("hidden");
			});
			
			$("#save-config").click(function(e){
				e.preventDefault();
				var tapeSize = $("#tape-size").val();
				if(tapeSize){
					turing.length = tapeSize;
				}
				var speed = $("#speed").val();
				if(speed){
					turing.speed = speed;
				}
				$(this).addClass("hidden");
			});

			$(".turing-tape1, .turing-tape2").on('dblclick', 'input', function(e){
				var $this = $(this);
				if($this.closest(".turing-tape1").length){
					$(".turing-tape1 .active").removeClass("active");
					$this.parent().addClass("active");
				}
				if($this.closest(".turing-tape2").length){
					$(".turing-tape2 .active").removeClass("active");
					$this.parent().addClass("active");
				}
			});
		});
	</script>
</head>
<body>
	<div id="container">
		<div id="tape" class="box">
			<h1>Turing Machine</h1>
			<div class="tapes">
				<h2>
					Current Tapes 
					<a class="btn pull-right hidden" id="save-tape" href="#">Save</a>
				</h2>
				<div class="tapes-list">
					<ol class="turing-tape1"></ol>
					<ol class="turing-tape2"></ol>
				</div>
			</div>
			<div class="states">
				<div class="w-horizontal">
					<div class="w w2">
						<h2>State</h2>
						<p id="state"></p>
					</div>
					<div class="w w2">
						<h2>Step</h2>
						<p id="count"></p>
					</div>
				</div>
			</div>
		</div>


		<div id="automato" class="box left">
			<h1>Automato</h1>

			<div class="transictions">
				<h2>
					Transitions
					<a class="btn pull-right hidden" id="save-automato" href="#">Save</a>
				</h2>
				<textarea id="steps-area"></textarea>
			</div>

			<!--
			<div id="canvas"></div>
			-->

		</div>


		<div id="config" class="box right">
			<h1>Control Panel</h1>

			<h2>
				Configuration
				<a class="btn pull-right hidden" id="save-config" href="#">Save</a>
			</h2>
			<dl>
				<dt>Tape Size</dt>
				<dd><input type="text" id="tape-size" /></dd>
			</dl>
			<dl>
				<dt>Speed</dt>
				<dd><input type="text" id="speed" /></dd>
			</dl>

			<h2>Actions</h2>
			<div class="actions">
				<a class="btn" id="run" href="#">
					<i class="fa fa-play"></i> <span>Execute</span>
				</a>
				<a class="btn" id="step" href="#">
					<i class="fa fa-step-forward"></i> Next step
				</a>
				<a class="btn" id="reset" href="#">
					<i class="fa fa-refresh"></i> Reset
				</a>
			</div>
		</div>

	</div>
</body>
</html>
